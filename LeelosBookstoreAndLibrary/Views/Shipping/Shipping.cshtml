@model LeelosBookstoreAndLibrary.Models.ShippingInfo

@{
    ViewBag.Title = "Shipping";
}

<h2>Shipping</h2>

@if (TempData["Message"] != null)
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />

    <style>
        /* Custom style to make toastr success green */
        .toast-success {
            background-color: #28a745 !important; /* Bootstrap green */
        }
    </style>

    <script>
        $(document).ready(function () {
            toastr.success('@TempData["Message"]', 'Success', { timeOut: 5000 });
        });
    </script>
}

@if (TempData["ErrorMessage"] != null)
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {
            toastr.error('@TempData["ErrorMessage"]', 'Error', { timeOut: 5000 });
        });
    </script>
}


@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
        {
            <p>@error.ErrorMessage</p>
        }
    </div>
}


@if (Model == null || string.IsNullOrEmpty(Model.Address))
{
    <p>No shipping address found.</p>
}
else
{
    <div id="saved-address" style="display: block;">
        <h3>Your Shipping Address:</h3>
        <p>@Model.Address, @Model.City, @Model.Governorate, @Model.ZipCode, @Model.Country</p> <!-- Display the shipping address -->
        <p>Phone Number: @Model.PhoneNumber</p>
        <button id="choose-different-address" class="btn btn-secondary">Choose a Different Address</button>
        <br /><br />
        <a href="@Url.Action("Payment", "Payment")" class="btn btn-success">Proceed to Payment</a>
    </div>
}

<!-- Form to enter a new address -->
<div id="shipping-form" style="display:@(Model == null || string.IsNullOrEmpty(Model.Address) ? "block" : "none");">
    @using (Html.BeginForm("ConfirmShipping", "Shipping", FormMethod.Post, new { id = "editAddressForm"}))
    {
        <div class="form-group">
            <label for="address">Address:</label>
            @Html.TextBox("Address", Model?.Address, new { @class = "form-control", required = "required" })
            @Html.ValidationMessage("Address")
        </div>

        <div class="form-group">
            <label for="city">City:</label>
            @Html.TextBox("City", Model?.City, new { @class = "form-control", required = "required" })
            @Html.ValidationMessage("City")
        </div>

        <div class="form-group">
            <label for="governate">State:</label>
            @Html.TextBox("Governorate", Model?.Governorate, new { @class = "form-control", required = "required" })
            @Html.ValidationMessage("Governorate")
        </div>

        <div class="form-group">
            <label for="zip">ZIP Code:</label>
            @Html.TextBox("ZipCode", Model?.ZipCode, new { @class = "form-control", required = "required" })
            @Html.ValidationMessage("ZipCode")
        </div>

        <div class="form-group">
            <label for="country">Country:</label>
            @Html.TextBox("Country", Model?.Country, new { @class = "form-control", required = "required" })
            @Html.ValidationMessage("Country")
        </div>

        <div class="form-group">
            <label for="phoneNumber">Phone Number:</label>
            @Html.TextBox("PhoneNumber", Model?.PhoneNumber, new { @class = "form-control", required = "required" })
            @Html.ValidationMessage("PhoneNumber")
        </div>

        <a href="#" onclick="showConfirmationModal(); return false;" class="btn btn-primary">Save Shipping Address</a>
    }
</div>

<!-- Confirm Edit Modal -->
<div class="modal" id="addressConfirmationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to save changes <strong id="editAddress"></strong>?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmAddressBtn">Save</button>
            </div>
        </div>
    </div>
</div>


<!-- JavaScript for handling modal and edit -->
<script type="text/javascript">
    function showConfirmationModal(title) {
        var confirmationModal = new bootstrap.Modal(document.getElementById('addressConfirmationModal'));
        confirmationModal.show();
    }

    document.getElementById("confirmAddressBtn").onclick = function () {
        document.getElementById('editAddressForm').submit();
    };
</script>

<script>
    // JavaScript to toggle between saved address and new address form
    document.getElementById('choose-different-address').addEventListener('click', function () {
        document.getElementById('saved-address').style.display = 'none';
        document.getElementById('shipping-form').style.display = 'block';
    });
</script>
