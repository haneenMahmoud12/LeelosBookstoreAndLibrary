@model LeelosBookstoreAndLibrary.Models.BooksViewModel

@{
    ViewBag.Title = "Books Index";
}

<h2>Books Index</h2>

<!-- Search form -->
<form method="get" action="@Url.Action("Index")">
    <input type="text" name="searchQuery" placeholder="Search by title, author, or genre..." value="@Model.SearchQuery" />
    <input type="submit" value="Search" />
</form>

<!-- Create book link for admin -->
@if (!string.IsNullOrEmpty(Session["UserId"]?.ToString()) && (int)Session["UserRole"] == 2)
{
    <p>
        @Html.ActionLink("Create New", "AddBook")
    </p>
}

<table class="table">
    <thead>
        <tr>
            <th>@Html.DisplayNameFor(model => model.Books.First().Title)</th>
            <th>Author</th>
            <th>@Html.DisplayNameFor(model => model.Books.First().Genre)</th>
            <th>@Html.DisplayNameFor(model => model.Books.First().Price)</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var book in Model.Books)
        {
            <tr>
                <td>@book.Title</td>
                <td>@book.Author.FirstName @book.Author.LastName</td>
                <td>@book.Genre</td>
                <td>@book.Price.ToString("F2")</td>
                <td>
                    @Html.ActionLink("Details", "BookDetails", new { id = book.Id })
                    @if (!string.IsNullOrEmpty(Session["UserId"]?.ToString()) && (int)Session["UserRole"] == 2)
                    {
                        <br />
                        @Html.ActionLink("Edit", "EditBook", new { id = book.Id })
                        <br />
                        @Html.ActionLink("Delete", "Delete", new { id = book.Id })
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Pagination -->
@if (Model.TotalBooksCount > Model.PageSize)
{
    <ul class="pagination">
        @for (int i = 1; i <= Math.Ceiling((double)Model.TotalBooksCount / Model.PageSize); i++)
        {
            <li class="@(i == Model.CurrentPage ? "active" : "")">
                <a href="@Url.Action("Index", new { page = i, pageSize = Model.PageSize, searchQuery = Model.SearchQuery })">@i</a>
            </li>
        }
    </ul>
}
