@model LeelosBookstoreAndLibrary.Models.Book

@{
    ViewBag.Title = "BookDetails";
}

@if (TempData["Message"] != null)
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script>
        $(document).ready(function () {
            toastr.success('@TempData["Message"]', 'Success', { timeOut: 5000 });
        });
    </script>
}

@*<partial name="_Notification" />
*@
<h2>Book Details</h2>


@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
        {
            <p>@error.ErrorMessage</p>
        }
    </div>
}


<!-- Book Details Section -->
<div>
    <hr />
    <dl class="dl-horizontal">
        <dt>@Html.DisplayNameFor(model => model.Title)</dt>
        <dd>@Html.DisplayFor(model => model.Title)</dd>

        <dt>@Html.DisplayNameFor(model => model.Description)</dt>
        <dd>@Html.DisplayFor(model => model.Description)</dd>

        <dt>Author</dt>
        <dd>@Html.DisplayFor(model => model.Author.FirstName) @Html.DisplayFor(model => model.Author.LastName)</dd>

        <dt>@Html.DisplayNameFor(model => model.Genre)</dt>
        <dd>@Html.DisplayFor(model => model.Genre)</dd>

        <dt>@Html.DisplayNameFor(model => model.Price)</dt>
        <dd>@($"{Math.Round(Model.Price,2)}")</dd>

        <dt>@Html.DisplayNameFor(model => model.Rating)</dt>
        <dd>@Html.DisplayFor(model => model.Rating)</dd>

        <dt>Publisher</dt>
        <dd>@Html.DisplayFor(model => model.Publisher.Name)</dd>

        <dt>@Html.DisplayNameFor(model => model.DatePublished)</dt>
        <dd>@Html.DisplayFor(model => model.DatePublished)</dd>

        <dt>@Html.DisplayNameFor(model => model.NumberOfPages)</dt>
        <dd>@Html.DisplayFor(model => model.NumberOfPages)</dd>


        @if (Model.StockQuantity > 0) // Ensure the book is available
        {
            <!-- Add to Cart Section -->
            <form action="@Url.Action("AddToCart", "ShoppingCart")" method="post">
                @Html.Hidden("bookId", Model.Id)
                <label>Quantity: </label>
                <input type="number" name="quantity" value="1" min="1" max="@Model.StockQuantity" />
                <button type="submit" class="btn btn-primary">Add to Cart</button>
            </form>

            <!-- Borrow Section -->
            <form action="@Url.Action("AddToBorrowCart", "Borrow")" method="post">
                @Html.Hidden("bookId", Model.Id)
                <button type="submit" class="btn btn-primary">Borrow</button>
            </form>


        }
        else
        {
            <span>Out of stock</span>
        }
    </dl>
</div>


<!-- Admin Actions -->
<p>
    @if (!string.IsNullOrEmpty(Session["UserId"]?.ToString()) && (int)Session["UserRole"] == 2)
    {
        @Html.ActionLink("Edit", "EditBook", new { id = Model.Id })
        @Html.Label("|")
        @Html.ActionLink("Delete", "Delete", new { id = Model.Id });
        <br />
    }

    @Html.ActionLink("Back to Home Page", "Index")
</p>

